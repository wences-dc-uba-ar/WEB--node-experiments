<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>The HTML5 Herald</title>
	<meta name="description" content="The HTML5 Herald">
	<meta name="author" content="SitePoint">
	<meta name="google-signin-client_id" content="627696795827-nama3n5f5g0agv0sobum11am5qr2ric8.apps.googleusercontent.com">
	<!-- <script src="https://apis.google.com/js/platform.js" async defer></script> -->
	<script src="https://apis.google.com/js/platform.js?onload=onLoadCallback" async defer></script>
	<script>
		var auth2; // The Sign-In object.
		var googleUser; // The current user.

		window.onLoadCallback = function(){
			console.log('onLoadCallback()');
			gapi.load('auth2', initSigninV2);
		}
		/**
		* Initializes Signin v2 and sets up listeners.
		*/
		var initSigninV2 = function() {
			console.log('function initSigninV2()');
			gapi.auth2.init({
				client_id: '627696795827-nama3n5f5g0agv0sobum11am5qr2ric8.apps.googleusercontent.com',
			    scope: 'profile'
				// scope: 'email',
				// fetch_basic_profile: false
			}).then(function (authInstance) {
				auth2 = authInstance;
		        console.info('then! authInstance',authInstance);
				// Listen for sign-in state changes.
				auth2.isSignedIn.listen(signinChanged);
				// Listen for changes to current user.
				auth2.currentUser.listen(userChanged);
				// Sign in the user if they are currently signed in.
				if (auth2.isSignedIn.get() == true) {
					auth2.signIn();
				}
				// Start with the current live values.
				refreshValues();
		    });
		};

		var signIn = function() {
			console.log('signIn()');
			auth2.signIn().then(function () {
				console.log('User signed in.');
			});
		}
		
		var signOut = function() {
			var auth2 = gapi.auth2.getAuthInstance();
			auth2.signOut().then(function () {
				console.log('User signed out.');
			});
		}

		var revokeAllScopes = function() {
			auth2.disconnect().then(function () {
				console.log('User disconnect.');
			});
		}
		/**
		* Listener method for sign-out live value.
		*
		* @param {boolean} val the updated signed out state.
		*/
		var signinChanged = function (val) {
			console.log('function signinChanged()');
			console.log('Signin state changed to ', val);
			document.getElementById('signed_in_cell').innerText = val;
		};

		/**
		* Listener method for when the user changes.
		*
		* @param {GoogleUser} user the updated user.
		*/
		var userChanged = function (user) {
			console.log('function userChanged()');
			console.log('User now: ', user);
			googleUser = user;
			updateGoogleUser();
			document.getElementById('curr_user_cell').innerText =
			JSON.stringify(user, undefined, 2);
		};

		/**
		* Updates the properties in the Google User table using the current user.
		*/
		var updateGoogleUser = function () {
			console.log('function updateGoogleUser()');
			if (googleUser) {
				document.getElementById('user_id').innerText = googleUser.getId();
				document.getElementById('user_scopes').innerText =
				googleUser.getGrantedScopes();
				document.getElementById('auth_response').innerText =
				JSON.stringify(googleUser.getAuthResponse(), undefined, 2);
			} else {
				document.getElementById('user_id').innerText = '--';
				document.getElementById('user_scopes').innerText = '--';
				document.getElementById('auth_response').innerText = '--';
			}
		};

		/**
		* Retrieves the current user and signed in states from the GoogleAuth
		* object.
		*/
		var refreshValues = function() {
			console.log('function refreshValues()');
			if (auth2){
				console.log('Refreshing values...');
				googleUser = auth2.currentUser.get();
				document.getElementById('curr_user_cell').innerText = JSON.stringify(googleUser, undefined, 2);
				document.getElementById('signed_in_cell').innerText = auth2.isSignedIn.get();
				updateGoogleUser();
			}
		}
	</script>
</head>
<body>
	<!-- <div class="g-signin2" data-onsuccess="onSignIn"></div> -->
	<button onclick="signIn()">sing in</button>
	<button onclick="revokeAllScopes()">disconnect</button>
	<hr/>
	<a href="#" onclick="signOut();">Sign out</a>
	<hr/>
	<div style="color:white;background: black;">signed_in_cell</div>		<pre id="signed_in_cell"></pre>
	<div style="color:white;background: black;">curr_user_cell</div>		<pre id="curr_user_cell"></pre>
	<div style="color:white;background: black;">user_id</div>				<pre id="user_id"></pre>
	<div style="color:white;background: black;">user_scopes</div>			<pre id="user_scopes"></pre>
	<div style="color:white;background: black;">auth_response</div>			<pre id="auth_response"></pre>
</body>
</html>
